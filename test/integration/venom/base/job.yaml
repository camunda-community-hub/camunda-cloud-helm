apiVersion: batch/v1
kind: Job
metadata:
  name: integration-venom
  labels:
    app: venom
    test: integration
spec:
  template:
    spec:
      containers:
      - name: venom
        image: ovhcom/venom:latest
        command:
        - sh
        - -c
        - |
          /usr/local/venom run ./tests/${VENOM_RUN_ARGS:-*.y*ml} ||
          (cat ./results/venom.log; exit 1)
        envFrom:
        - configMapRef:
            name: venom-env-vars
        volumeMounts:
        - name: venom-tests
          mountPath: /workdir/tests
      volumes:
      - name: venom-tests
        configMap:
          name: venom-tests
      restartPolicy: Never
  backoffLimit: 0
